package com.example.checkinrequestMS.PlaceAPI.domain.service.tools;

import com.example.checkinrequestMS.PlaceAPI.domain.Place;
import com.fasterxml.jackson.core.JsonProcessingException;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.Spy;
import org.mockito.junit.jupiter.MockitoExtension;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.boot.test.mock.mockito.SpyBean;

import java.util.List;

import static org.junit.jupiter.api.Assertions.*;

@ExtendWith(MockitoExtension.class)
class KakaoParserTest {

    @Spy
    KakaoParser kakaoParser;

    @Test
    void parsePlaceInfo() throws JsonProcessingException {
        String response = "[{\"address_name\":\"서울 중구 명동2가 25-36\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 분식\",\"distance\":\"0\",\"id\":\"10332413\",\"phone\":\"02-776-5348\",\"place_name\":\"명동교자 본점\",\"place_url\":\"http://place.map.kakao.com/10332413\",\"road_address_name\":\"서울 중구 명동10길 29\",\"x\":\"126.98561429978552\",\"y\":\"37.56255453417897\"},{\"address_name\":\"서울 중구 명동2가 4-2\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 한식\",\"distance\":\"42\",\"id\":\"26853115\",\"phone\":\"02-3789-9292\",\"place_name\":\"순남시래기 명동직영점\",\"place_url\":\"http://place.map.kakao.com/26853115\",\"road_address_name\":\"서울 중구 명동10길 35-20\",\"x\":\"126.985784007806\",\"y\":\"37.5629131513515\"},{\"address_name\":\"서울 중구 명동2가 31-4\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 한식 > 해물,생선\",\"distance\":\"33\",\"id\":\"26874878\",\"phone\":\"02-318-2234\",\"place_name\":\"더식당 명동점\",\"place_url\":\"http://place.map.kakao.com/26874878\",\"road_address_name\":\"서울 중구 명동10길 36\",\"x\":\"126.98551249166562\",\"y\":\"37.562257192861\"},{\"address_name\":\"서울 중구 명동2가 26-1\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 한식 > 냉면\",\"distance\":\"24\",\"id\":\"7871208\",\"phone\":\"02-776-8430\",\"place_name\":\"명동함흥면옥 본점\",\"place_url\":\"http://place.map.kakao.com/7871208\",\"road_address_name\":\"서울 중구 명동10길 35-19\",\"x\":\"126.98568556457165\",\"y\":\"37.562769881012464\"},{\"address_name\":\"서울 중구 충무로2가 6\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 분식 > 떡볶이 > 두끼떡볶이\",\"distance\":\"35\",\"id\":\"1217823373\",\"phone\":\"02-318-1333\",\"place_name\":\"두끼떡볶이 명동역점\",\"place_url\":\"http://place.map.kakao.com/1217823373\",\"road_address_name\":\"서울 중구 명동10길 35-3\",\"x\":\"126.985883724026\",\"y\":\"37.5623103966294\"},{\"address_name\":\"서울 중구 명동2가 4-2\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 한식 > 찌개,전골\",\"distance\":\"45\",\"id\":\"15188892\",\"phone\":\"02-753-3330\",\"place_name\":\"송탄부대찌개\",\"place_url\":\"http://place.map.kakao.com/15188892\",\"road_address_name\":\"서울 중구 명동10길 35-20\",\"x\":\"126.985811168704\",\"y\":\"37.5629311745487\"},{\"address_name\":\"서울 중구 명동2가 31-4\",\"category_group_code\":\"CE7\",\"category_group_name\":\"카페\",\"category_name\":\"음식점 > 카페 > 테마카페\",\"distance\":\"35\",\"id\":\"1922966600\",\"phone\":\"02-3789-4690\",\"place_name\":\"미스터힐링 명동역본점\",\"place_url\":\"http://place.map.kakao.com/1922966600\",\"road_address_name\":\"서울 중구 명동10길 36\",\"x\":\"126.985517021105\",\"y\":\"37.5622463814575\"},{\"address_name\":\"서울 중구 명동2가 3-11\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 간식 > 토스트 > 이삭토스트\",\"distance\":\"46\",\"id\":\"1780260025\",\"phone\":\"02-3789-2043\",\"place_name\":\"이삭토스트 서울명동성당점\",\"place_url\":\"http://place.map.kakao.com/1780260025\",\"road_address_name\":\"서울 중구 명동10길 17-1\",\"x\":\"126.98551688174588\",\"y\":\"37.56296627767801\"},{\"address_name\":\"서울 중구 명동2가 4-2\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 일식\",\"distance\":\"46\",\"id\":\"689319706\",\"phone\":\"\",\"place_name\":\"우와 명동점\",\"place_url\":\"http://place.map.kakao.com/689319706\",\"road_address_name\":\"서울 중구 명동10길 35-20\",\"x\":\"126.985813431372\",\"y\":\"37.5629365807995\"},{\"address_name\":\"서울 중구 명동2가 4-2\",\"category_group_code\":\"CE7\",\"category_group_name\":\"카페\",\"category_name\":\"음식점 > 카페 > 테마카페 > 디저트카페 > 설빙\",\"distance\":\"49\",\"id\":\"278226558\",\"phone\":\"02-774-7995\",\"place_name\":\"설빙 서울명동2호점\",\"place_url\":\"http://place.map.kakao.com/278226558\",\"road_address_name\":\"서울 중구 명동10길 35-20\",\"x\":\"126.98583832671558\",\"y\":\"37.56296451467953\"},{\"address_name\":\"서울 중구 명동2가 31-1\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 간식 > 도넛\",\"distance\":\"38\",\"id\":\"312050240\",\"phone\":\"\",\"place_name\":\"말똥카니발 명동점\",\"place_url\":\"http://place.map.kakao.com/312050240\",\"road_address_name\":\"서울 중구 명동8길 27\",\"x\":\"126.985177412888\",\"y\":\"37.5625355592102\"},{\"address_name\":\"서울 중구 명동2가 28-1\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 한식 > 육류,고기\",\"distance\":\"33\",\"id\":\"27394073\",\"phone\":\"02-318-2426\",\"place_name\":\"황금목장 명동성당점\",\"place_url\":\"http://place.map.kakao.com/27394073\",\"road_address_name\":\"서울 중구 명동10길 23\",\"x\":\"126.985544068887\",\"y\":\"37.5628482504689\"},{\"address_name\":\"서울 중구 명동2가 31-4\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 중식 > 중국요리 > 라화쿵부\",\"distance\":\"32\",\"id\":\"1882249937\",\"phone\":\"02-319-6866\",\"place_name\":\"라화쿵부 명동2호점\",\"place_url\":\"http://place.map.kakao.com/1882249937\",\"road_address_name\":\"서울 중구 명동10길 36\",\"x\":\"126.985521544963\",\"y\":\"37.5622644019443\"},{\"address_name\":\"서울 중구 명동2가 23\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 한식 > 육류,고기 > 갈비\",\"distance\":\"33\",\"id\":\"1826780837\",\"phone\":\"02-754-7018\",\"place_name\":\"신서갈비\",\"place_url\":\"http://place.map.kakao.com/1826780837\",\"road_address_name\":\"서울 중구 명동10길 35-10\",\"x\":\"126.985992342458\",\"y\":\"37.5625131337951\"},{\"address_name\":\"서울 중구 명동2가 31-5\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 한식 > 죽\",\"distance\":\"42\",\"id\":\"489820169\",\"phone\":\"\",\"place_name\":\"다미죽\",\"place_url\":\"http://place.map.kakao.com/489820169\",\"road_address_name\":\"서울 중구 명동10길 38\",\"x\":\"126.985544198409\",\"y\":\"37.5621779090464\"},{\"address_name\":\"서울 중구 명동2가 31-1\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 뷔페\",\"distance\":\"39\",\"id\":\"1983687362\",\"phone\":\"02-721-5960\",\"place_name\":\"솔라리아니시테츠호텔 스카이라운지바\",\"place_url\":\"http://place.map.kakao.com/1983687362\",\"road_address_name\":\"서울 중구 명동8길 27\",\"x\":\"126.985163837409\",\"y\":\"37.5625022206325\"},{\"address_name\":\"서울 중구 명동2가 3-9\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 한식\",\"distance\":\"48\",\"id\":\"674299064\",\"phone\":\"\",\"place_name\":\"1992덮밥앤짜글이 명동1호점\",\"place_url\":\"http://place.map.kakao.com/674299064\",\"road_address_name\":\"서울 중구 명동10길 17-1\",\"x\":\"126.98551235243752\",\"y\":\"37.56297618808365\"},{\"address_name\":\"서울 중구 명동2가 22\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 도시락\",\"distance\":\"32\",\"id\":\"18890435\",\"phone\":\"02-775-8199\",\"place_name\":\"명동덮밥도시락\",\"place_url\":\"http://place.map.kakao.com/18890435\",\"road_address_name\":\"서울 중구 명동10길 35-12\",\"x\":\"126.985965155301\",\"y\":\"37.56263566609694\"},{\"address_name\":\"서울 중구 충무로2가 3-35\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 한식 > 육류,고기\",\"distance\":\"40\",\"id\":\"27583437\",\"phone\":\"\",\"place_name\":\"홍빠명돈가 명동본점\",\"place_url\":\"http://place.map.kakao.com/27583437\",\"road_address_name\":\"서울 중구 명동10길 35-3\",\"x\":\"126.985766032653\",\"y\":\"37.5622067678906\"},{\"address_name\":\"서울 중구 명동2가 31-4\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 일식 > 돈까스,우동\",\"distance\":\"32\",\"id\":\"27154230\",\"phone\":\"\",\"place_name\":\"수제왕돈까스 명동2호점\",\"place_url\":\"http://place.map.kakao.com/27154230\",\"road_address_name\":\"서울 중구 명동10길 36\",\"x\":\"126.985521543568\",\"y\":\"37.5622716099169\"},{\"address_name\":\"서울 중구 명동2가 25-26\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 치킨 > 아라치\",\"distance\":\"22\",\"id\":\"570059283\",\"phone\":\"\",\"place_name\":\"아라치 명동점\",\"place_url\":\"http://place.map.kakao.com/570059283\",\"road_address_name\":\"서울 중구 명동10길 35-9\",\"x\":\"126.9858157897\",\"y\":\"37.5624374290049\"},{\"address_name\":\"서울 중구 명동2가 25-37\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 간식 > 아이스크림\",\"distance\":\"4\",\"id\":\"2068514414\",\"phone\":\"\",\"place_name\":\"테네로\",\"place_url\":\"http://place.map.kakao.com/2068514414\",\"road_address_name\":\"서울 중구 명동10길 29-1\",\"x\":\"126.985643733531\",\"y\":\"37.5625239038789\"},{\"address_name\":\"서울 중구 명동2가 31-5\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 술집 > 호프,요리주점\",\"distance\":\"41\",\"id\":\"1377213822\",\"phone\":\"0507-1424-3778\",\"place_name\":\"젠틀래빗 명동점\",\"place_url\":\"http://place.map.kakao.com/1377213822\",\"road_address_name\":\"서울 중구 명동10길 38\",\"x\":\"126.985562306383\",\"y\":\"37.562185119235\"},{\"address_name\":\"서울 중구 명동2가 21\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 한식\",\"distance\":\"36\",\"id\":\"11308398\",\"phone\":\"\",\"place_name\":\"신우정\",\"place_url\":\"http://place.map.kakao.com/11308398\",\"road_address_name\":\"서울 중구 명동10길 35-18\",\"x\":\"126.985879104677\",\"y\":\"37.5627978352111\"},{\"address_name\":\"서울 중구 명동2가 25-26\",\"category_group_code\":\"FD6\",\"category_group_name\":\"음식점\",\"category_name\":\"음식점 > 한식\",\"distance\":\"22\",\"id\":\"1990931721\",\"phone\":\"\",\"place_name\":\"TEMPTERK\",\"place_url\":\"http://place.map.kakao.com/1990931721\",\"road_address_name\":\"서울 중구 명동10길 35-9\",\"x\":\"126.9858157897\",\"y\":\"37.5624374290049\"}]";

        List<Place> places = kakaoParser.parsePlaceInfo(response);

        assertEquals(25, places.size());
        assertEquals("명동교자 본점", places.get(0).getPlaceName());
        assertEquals("서울 중구 명동2가 25-36", places.get(0).getAddressName());
        assertEquals("음식점 > 분식", places.get(0).getCategoryName());
        assertEquals("02-776-5348", places.get(0).getPhone());
        assertEquals("http://place.map.kakao.com/10332413", places.get(0).getPlaceUrl());
        assertEquals(126.98561429978552, places.get(0).getX());
        assertEquals(37.56255453417897, places.get(0).getY());
    }

}